<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_80) on Wed Jan 31 11:20:50 GMT 2018 -->
<title>PromotionMgr (KonaKart Server Engine API Documentation)</title>
<meta name="date" content="2018-01-31">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="PromotionMgr (KonaKart Server Engine API Documentation)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../com/konakart/bl/ProductMgrEE.html" title="class in com.konakart.bl"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../com/konakart/bl/PromotionMgr.StaticData.html" title="class in com.konakart.bl"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?com/konakart/bl/PromotionMgr.html" target="_top">Frames</a></li>
<li><a href="PromotionMgr.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested_class_summary">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.konakart.bl</div>
<h2 title="Class PromotionMgr" class="title">Class PromotionMgr</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li><a href="../../../com/konakart/bl/BaseMgr.html" title="class in com.konakart.bl">com.konakart.bl.BaseMgr</a></li>
<li>
<ul class="inheritance">
<li>com.konakart.bl.PromotionMgr</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd><a href="../../../com/konakart/blif/PromotionMgrIf.html" title="interface in com.konakart.blif">PromotionMgrIf</a></dd>
</dl>
<dl>
<dt>Direct Known Subclasses:</dt>
<dd><a href="../../../com/konakart/bl/PromotionMgrEE.html" title="class in com.konakart.bl">PromotionMgrEE</a></dd>
</dl>
<hr>
<br>
<pre>public class <span class="strong">PromotionMgr</span>
extends <a href="../../../com/konakart/bl/BaseMgr.html" title="class in com.konakart.bl">BaseMgr</a>
implements <a href="../../../com/konakart/blif/PromotionMgrIf.html" title="interface in com.konakart.blif">PromotionMgrIf</a></pre>
<div class="block">Promotions Manager</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="nested_class_summary">
<!--   -->
</a>
<h3>Nested Class Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Nested Class Summary table, listing nested classes, and an explanation">
<caption><span>Nested Classes</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Class and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected class&nbsp;</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.StaticData.html" title="class in com.konakart.bl">PromotionMgr.StaticData</a></strong></code>
<div class="block">Used to store the static data of this manager</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#ALL">ALL</a></strong></code>
<div class="block">Constant for Promotion Rule</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#COUPON_DOESNT_EXIST">COUPON_DOESNT_EXIST</a></strong></code>
<div class="block">Coupon doesn't exist</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#COUPON_EXISTS_ACTIVE">COUPON_EXISTS_ACTIVE</a></strong></code>
<div class="block">Coupon exists and is active</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#COUPON_EXISTS_INACTIVE">COUPON_EXISTS_INACTIVE</a></strong></code>
<div class="block">Coupon exists but is no longer active</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#EXCLUDE">EXCLUDE</a></strong></code>
<div class="block">Constant for Promotion Rule</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected static int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#GIFT_CERTIFICATE_RELATION_TYPE">GIFT_CERTIFICATE_RELATION_TYPE</a></strong></code>
<div class="block">Constant for Promotion To Product Relation</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#INCLUDE">INCLUDE</a></strong></code>
<div class="block">Constant for Promotion Rule</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected static org.apache.commons.logging.Log</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#log">log</a></strong></code>
<div class="block">the log</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected static java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#mutex">mutex</a></strong></code>
<div class="block">mutex</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected static int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#PROMOTION_RELATION_TYPE">PROMOTION_RELATION_TYPE</a></strong></code>
<div class="block">Constant for Promotion To Product Relation</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected static int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#promotionUsageCountMaxRetries">promotionUsageCountMaxRetries</a></strong></code>
<div class="block">Number of times to retry the promotion usage count update SQL</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected static java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#promotionUseMutex">promotionUseMutex</a></strong></code>
<div class="block">Mutex for updating promotion usage count</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected static java.util.Map&lt;java.lang.String,<a href="../../../com/konakart/bl/PromotionMgr.StaticData.html" title="class in com.konakart.bl">PromotionMgr.StaticData</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#staticDataHM">staticDataHM</a></strong></code>
<div class="block">Hash Map that contains the static data</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="fields_inherited_from_class_com.konakart.bl.BaseMgr">
<!--   -->
</a>
<h3>Fields inherited from class&nbsp;com.konakart.bl.<a href="../../../com/konakart/bl/BaseMgr.html" title="class in com.konakart.bl">BaseMgr</a></h3>
<code><a href="../../../com/konakart/bl/BaseMgr.html#templateBaseDir">templateBaseDir</a></code></li>
</ul>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#PromotionMgr(com.konakart.appif.KKEngIf)">PromotionMgr</a></strong>(<a href="../../../com/konakart/appif/KKEngIf.html" title="interface in com.konakart.appif">KKEngIf</a>&nbsp;eng)</code>
<div class="block">Constructor</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#applyDiscount(com.konakart.appif.ProductIf,%20com.konakart.appif.PromotionResultIf,%20com.konakart.appif.PromotionOptionsIf)">applyDiscount</a></strong>(<a href="../../../com/konakart/appif/ProductIf.html" title="interface in com.konakart.appif">ProductIf</a>&nbsp;prod,
             <a href="../../../com/konakart/appif/PromotionResultIf.html" title="interface in com.konakart.appif">PromotionResultIf</a>&nbsp;promResult,
             <a href="../../../com/konakart/appif/PromotionOptionsIf.html" title="interface in com.konakart.appif">PromotionOptionsIf</a>&nbsp;options)</code>
<div class="block">Apply the promotion discount to a product</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#checkCategory(com.konakart.app.Promotion,%20com.konakart.appif.ProductIf,%20java.util.HashMap,%20java.util.HashMap)">checkCategory</a></strong>(<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>&nbsp;prm,
             <a href="../../../com/konakart/appif/ProductIf.html" title="interface in com.konakart.appif">ProductIf</a>&nbsp;prod,
             java.util.HashMap&lt;java.lang.String,java.lang.String&gt;&nbsp;promotionCatMap,
             java.util.HashMap&lt;java.lang.Integer,java.util.ArrayList&lt;java.lang.Integer&gt;&gt;&nbsp;productCatIdMap)</code>
<div class="block">We check to see whether the product category is a category that can use the promotion.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#checkCoupon(com.konakart.app.Promotion,%20com.konakart.app.Order)">checkCoupon</a></strong>(<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>&nbsp;prm,
           <a href="../../../com/konakart/app/Order.html" title="class in com.konakart.app">Order</a>&nbsp;order)</code>
<div class="block">If the promotion requires a coupon, we try and find one or more active coupons for the
 promotion that have a coupon code equal to the one in the order.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#checkCoupon(com.konakart.app.Promotion,%20java.lang.String[])">checkCoupon</a></strong>(<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>&nbsp;prm,
           java.lang.String[]&nbsp;coupons)</code>
<div class="block">If the promotion requires a coupon, we try and find one or more active coupons for the
 promotion that have a coupon code equal to one of the ones the array.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#checkCoupon(java.lang.String)">checkCoupon</a></strong>(java.lang.String&nbsp;couponCode)</code>
<div class="block">This method is used to verify whether a coupon code actually exists and if it does, whether
 the coupon is still active.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#checkCustomer(com.konakart.app.Promotion,%20int)">checkCustomer</a></strong>(<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>&nbsp;prm,
             int&nbsp;customerId)</code>
<div class="block">We check to see whether the customer submitting the order is a customer that can use the
 promotion.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#checkCustomerGroup(com.konakart.app.Promotion,%20int)">checkCustomerGroup</a></strong>(<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>&nbsp;prm,
                  int&nbsp;customerId)</code>
<div class="block">We check to see whether the group of the customer submitting the order is a group that can
 use the promotion.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#checkCustomerUse(com.konakart.app.Promotion,%20int)">checkCustomerUse</a></strong>(<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>&nbsp;prm,
                int&nbsp;customerId)</code>
<div class="block">If the promotion has the maxUse attribute set to a positive value, then we check to see
 whether the customer can still use the promotion or whether he has already used it the
 maximum number of times allowed.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#checkExpression(com.konakart.app.Promotion,%20int,%20java.util.HashMap)">checkExpression</a></strong>(<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>&nbsp;prm,
               int&nbsp;customerId,
               java.util.HashMap&lt;java.lang.Integer,java.util.ArrayList&lt;java.lang.Integer&gt;&gt;&nbsp;expressionIdMap)</code>
<div class="block">We check to see whether the expression evaluates to TRUE</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#checkManufacturer(com.konakart.app.Promotion,%20com.konakart.appif.ProductIf,%20java.util.HashMap)">checkManufacturer</a></strong>(<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>&nbsp;prm,
                 <a href="../../../com/konakart/appif/ProductIf.html" title="interface in com.konakart.appif">ProductIf</a>&nbsp;prod,
                 java.util.HashMap&lt;java.lang.String,java.lang.String&gt;&nbsp;promotionManuMap)</code>
<div class="block">We check to see whether the product manufacturer is a manufacturer that can use the
 promotion.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#checkProduct(com.konakart.app.Promotion,%20com.konakart.appif.OrderProductIf,%20java.util.HashMap)">checkProduct</a></strong>(<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>&nbsp;prm,
            <a href="../../../com/konakart/appif/OrderProductIf.html" title="interface in com.konakart.appif">OrderProductIf</a>&nbsp;orderProd,
            java.util.HashMap&lt;java.lang.String,<a href="../../../com/konakart/app/PromotionProduct.html" title="class in com.konakart.app">PromotionProduct</a>&gt;&nbsp;promotionProdMap)</code>
<div class="block">We check to see whether the product is a product that can use the promotion.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected boolean</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#checkPromotion(com.konakart.app.Promotion)">checkPromotion</a></strong>(<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>&nbsp;prm)</code>
<div class="block">Checks the validity of the promotion object.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>[]</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#getAllPromotions()">getAllPromotions</a></strong>()</code>
<div class="block">Returns an array of all active promotions</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="../../../com/konakart/app/Coupon.html" title="class in com.konakart.app">Coupon</a></code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#getCouponPerId(int,%20com.konakart.appif.CouponOptionsIf)">getCouponPerId</a></strong>(int&nbsp;couponId,
              <a href="../../../com/konakart/appif/CouponOptionsIf.html" title="interface in com.konakart.appif">CouponOptionsIf</a>&nbsp;options)</code>
<div class="block">Returns a coupon for the coupon id passed in as a parameter.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../com/konakart/app/Coupon.html" title="class in com.konakart.app">Coupon</a>[]</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#getCouponsPerCode(java.lang.String,%20com.konakart.appif.CouponOptionsIf)">getCouponsPerCode</a></strong>(java.lang.String&nbsp;couponCode,
                 <a href="../../../com/konakart/appif/CouponOptionsIf.html" title="interface in com.konakart.appif">CouponOptionsIf</a>&nbsp;options)</code>
<div class="block">Returns an array of coupons for the coupon code passed in as a parameter.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#getCustomerId(java.lang.String,%20int)">getCustomerId</a></strong>(java.lang.String&nbsp;sessionId,
             int&nbsp;customerId)</code>
<div class="block">If the sessionId is null, we check the customerId to ensure that it is negative.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected <a href="../../../com/konakart/app/OrderProduct.html" title="class in com.konakart.app">OrderProduct</a>[]</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#getOrderProductsFromProduct(com.konakart.appif.ProductIf)">getOrderProductsFromProduct</a></strong>(<a href="../../../com/konakart/appif/ProductIf.html" title="interface in com.konakart.appif">ProductIf</a>&nbsp;prod)</code>
<div class="block">Creates OrderProducts from a product so that we can reuse the checkProduct() method.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="../../../com/konakart/appif/PromotionIf.html" title="interface in com.konakart.appif">PromotionIf</a></code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#getPromotion(int,%20java.lang.String,%20int,%20com.konakart.appif.FetchPromotionOptionsIf,%20com.konakart.appif.FetchProductOptionsIf)">getPromotion</a></strong>(int&nbsp;promotionId,
            java.lang.String&nbsp;promotionName,
            int&nbsp;languageId,
            <a href="../../../com/konakart/appif/FetchPromotionOptionsIf.html" title="interface in com.konakart.appif">FetchPromotionOptionsIf</a>&nbsp;prmOptions,
            <a href="../../../com/konakart/appif/FetchProductOptionsIf.html" title="interface in com.konakart.appif">FetchProductOptionsIf</a>&nbsp;prodOptions)</code>
<div class="block">This API call is used to retrieve a single promotion matching an id or name.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected java.util.HashMap&lt;java.lang.String,java.lang.String&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#getPromotionCategoryMap(com.konakart.appif.PromotionIf[])">getPromotionCategoryMap</a></strong>(<a href="../../../com/konakart/appif/PromotionIf.html" title="interface in com.konakart.appif">PromotionIf</a>[]&nbsp;activePromotions)</code>
<div class="block">Create a hash map of all of the categories associated with the active promotions with a
 single database query</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#getPromotionCategoryMapKey(int,%20int)">getPromotionCategoryMapKey</a></strong>(int&nbsp;promotionId,
                          int&nbsp;catId)</code>
<div class="block">Create a unique key for the Promotion Category Map</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected java.util.HashMap&lt;java.lang.Integer,java.util.ArrayList&lt;java.lang.Integer&gt;&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#getPromotionExpressionMap(com.konakart.appif.PromotionIf[])">getPromotionExpressionMap</a></strong>(<a href="../../../com/konakart/appif/PromotionIf.html" title="interface in com.konakart.appif">PromotionIf</a>[]&nbsp;activePromotions)</code>
<div class="block">Create a hash map of all of the expressions associated with the active promotions with a
 single database query</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#getPromotionIdForGiftCertificate(int,%20int,%20int)">getPromotionIdForGiftCertificate</a></strong>(int&nbsp;productId,
                                int&nbsp;productOptionId,
                                int&nbsp;productOptionValueId)</code>
<div class="block">Protected method for common code to get the promotion id of a promotion connected to a gift
 certificate.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#getPromotionIdForGiftCertificate(com.konakart.appif.OrderProductIf)">getPromotionIdForGiftCertificate</a></strong>(<a href="../../../com/konakart/appif/OrderProductIf.html" title="interface in com.konakart.appif">OrderProductIf</a>&nbsp;op)</code>
<div class="block">Get the promotion id for an order product object containing a gift certificate.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected java.util.HashMap&lt;java.lang.String,java.lang.String&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#getPromotionManufacturerMap(com.konakart.appif.PromotionIf[])">getPromotionManufacturerMap</a></strong>(<a href="../../../com/konakart/appif/PromotionIf.html" title="interface in com.konakart.appif">PromotionIf</a>[]&nbsp;activePromotions)</code>
<div class="block">Create a hash map of all of the manufacturers associated with the active promotions with a
 single database query</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#getPromotionManufacturerMapKey(int,%20int)">getPromotionManufacturerMapKey</a></strong>(int&nbsp;promotionId,
                              int&nbsp;manuId)</code>
<div class="block">Create a unique key for the Promotion Manufacturer Map</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected java.util.HashMap&lt;java.lang.String,<a href="../../../com/konakart/app/PromotionProduct.html" title="class in com.konakart.app">PromotionProduct</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#getPromotionProductMap(com.konakart.appif.PromotionIf[],%20com.konakart.app.Order,%20com.konakart.appif.ProductIf[])">getPromotionProductMap</a></strong>(<a href="../../../com/konakart/appif/PromotionIf.html" title="interface in com.konakart.appif">PromotionIf</a>[]&nbsp;activePromotions,
                      <a href="../../../com/konakart/app/Order.html" title="class in com.konakart.app">Order</a>&nbsp;order,
                      <a href="../../../com/konakart/appif/ProductIf.html" title="interface in com.konakart.appif">ProductIf</a>[]&nbsp;products)</code>
<div class="block">Create a hash map of all of the products associated with the active promotions with a single
 database query.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#getPromotionProductMapKey(int,%20int,%20int,%20int)">getPromotionProductMapKey</a></strong>(int&nbsp;promotionId,
                         int&nbsp;prodId,
                         int&nbsp;prodOptionId,
                         int&nbsp;prodOptionValueId)</code>
<div class="block">Create a unique key for the Promotion Product Map</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected <a href="../../../com/konakart/appif/PromotionResultIf.html" title="interface in com.konakart.appif">PromotionResultIf</a>[]</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#getPromotionResultArray(com.konakart.appif.PromotionResultIf[],%20com.konakart.app.PromotionResult)">getPromotionResultArray</a></strong>(<a href="../../../com/konakart/appif/PromotionResultIf.html" title="interface in com.konakart.appif">PromotionResultIf</a>[]&nbsp;currentArray,
                       <a href="../../../com/konakart/app/PromotionResult.html" title="class in com.konakart.app">PromotionResult</a>&nbsp;newResult)</code>
<div class="block">Utility method to add a PromotionResult object on to the end of an array</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>[]</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#getPromotions(java.lang.String,%20com.konakart.app.Order)">getPromotions</a></strong>(java.lang.String&nbsp;orderTotalCode,
             <a href="../../../com/konakart/app/Order.html" title="class in com.konakart.app">Order</a>&nbsp;order)</code>
<div class="block">We return all active promotions for the orderTotalCode passed in as a parameter.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>[]</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#getPromotionsPerCoupon(java.lang.String,%20int,%20com.konakart.appif.PromotionOptionsIf)">getPromotionsPerCoupon</a></strong>(java.lang.String&nbsp;couponCode,
                      int&nbsp;couponId,
                      <a href="../../../com/konakart/appif/PromotionOptionsIf.html" title="interface in com.konakart.appif">PromotionOptionsIf</a>&nbsp;options)</code>
<div class="block">This method is used to return an array of promotions associated with the coupon(s) identified
 by the input parameters.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected <a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>[]</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#getPromotionsPerOrderTotalCode(java.util.ArrayList)">getPromotionsPerOrderTotalCode</a></strong>(java.util.ArrayList&lt;java.lang.String&gt;&nbsp;orderTotalCodeList)</code>
<div class="block">The active promotions related to the list of orderTotalCodes passed in as a parameter, are
 fetched from the database and returned.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected <a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>[]</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#getPromotionsPerOrderTotalCode(java.lang.String)">getPromotionsPerOrderTotalCode</a></strong>(java.lang.String&nbsp;orderTotalCode)</code>
<div class="block">The active promotions related to the list of orderTotalCodes passed in as a parameter, are
 fetched from the database and returned.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../com/konakart/appif/ProductIf.html" title="interface in com.konakart.appif">ProductIf</a>[]</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#getPromotionsPerProducts(java.lang.String,%20int,%20com.konakart.appif.ProductIf[],%20com.konakart.appif.PromotionIf[],%20java.lang.String[],%20com.konakart.appif.PromotionOptionsIf)">getPromotionsPerProducts</a></strong>(java.lang.String&nbsp;sessionId,
                        int&nbsp;customerId,
                        <a href="../../../com/konakart/appif/ProductIf.html" title="interface in com.konakart.appif">ProductIf</a>[]&nbsp;products,
                        <a href="../../../com/konakart/appif/PromotionIf.html" title="interface in com.konakart.appif">PromotionIf</a>[]&nbsp;promotions,
                        java.lang.String[]&nbsp;couponCodes,
                        <a href="../../../com/konakart/appif/PromotionOptionsIf.html" title="interface in com.konakart.appif">PromotionOptionsIf</a>&nbsp;options)</code>
<div class="block">This method is used to calculate a discount on individual products so that the discount can
 be displayed without having to add the product to the cart.<br>
 The method receives an array of products and returns an array of products with attached
 PromotionResult objects that contain the results of one or more of the promotions passed in
 as a parameter.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#getPromotionUsageCountMaxRetries()">getPromotionUsageCountMaxRetries</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>int</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#insertCoupon(com.konakart.appif.CouponIf,%20int)">insertCoupon</a></strong>(<a href="../../../com/konakart/appif/CouponIf.html" title="interface in com.konakart.appif">CouponIf</a>&nbsp;coupon,
            int&nbsp;promotionId)</code>
<div class="block">Insert a coupon and associate it with the promotion referenced by promotionId.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#processPrice(com.konakart.appif.ProductIf,%20com.konakart.appif.PromotionOptionsIf)">processPrice</a></strong>(<a href="../../../com/konakart/appif/ProductIf.html" title="interface in com.konakart.appif">ProductIf</a>&nbsp;prod,
            <a href="../../../com/konakart/appif/PromotionOptionsIf.html" title="interface in com.konakart.appif">PromotionOptionsIf</a>&nbsp;options)</code>
<div class="block">We apply the discount to a product, taking into consideration the rules to decide which
 promotion discount to select</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#refreshConfigs()">refreshConfigs</a></strong>()</code>
<div class="block">Refresh the configuration of the Promotion manager</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#setCouponCriteriaWithStandardAttributes(com.konakart.db.KKCriteria)">setCouponCriteriaWithStandardAttributes</a></strong>(<a href="../../../com/konakart/db/KKCriteria.html" title="class in com.konakart.db">KKCriteria</a>&nbsp;c)</code>
<div class="block">Set the criteria object with all of the attributes for a coupon</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#setPromotionCriteriaWithStandardAttributes(com.konakart.db.KKCriteria)">setPromotionCriteriaWithStandardAttributes</a></strong>(<a href="../../../com/konakart/db/KKCriteria.html" title="class in com.konakart.db">KKCriteria</a>&nbsp;c)</code>
<div class="block">Set the criteria object with all of the attributes for a promotion</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#setPromotionUsageCountMaxRetries(int)">setPromotionUsageCountMaxRetries</a></strong>(int&nbsp;promotionUsageCountMaxRetries)</code>
<div class="block">The maximum number of optimistic concurrency retries when setting the promotion usage count</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#updatePromotionUsage(com.konakart.app.Order)">updatePromotionUsage</a></strong>(<a href="../../../com/konakart/app/Order.html" title="class in com.konakart.app">Order</a>&nbsp;order)</code>
<div class="block">If the order has any associated coupons we iterate through the coupons and increment the
 timesUsed attribute.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../../com/konakart/bl/PromotionMgr.html#validateCoupon(com.konakart.appif.CouponIf)">validateCoupon</a></strong>(<a href="../../../com/konakart/appif/CouponIf.html" title="interface in com.konakart.appif">CouponIf</a>&nbsp;coupon)</code>
<div class="block">Used to validate a coupon before inserting</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_com.konakart.bl.BaseMgr">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;com.konakart.bl.<a href="../../../com/konakart/bl/BaseMgr.html" title="class in com.konakart.bl">BaseMgr</a></h3>
<code><a href="../../../com/konakart/bl/BaseMgr.html#acquireLock(java.lang.String)">acquireLock</a>, <a href="../../../com/konakart/bl/BaseMgr.html#addInsertAttr(org.apache.torque.util.Criteria,%20java.lang.String,%20int)">addInsertAttr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#addInsertAttr(org.apache.torque.util.Criteria,%20java.lang.String,%20java.lang.Object)">addInsertAttr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#addStringRuleConstraint(com.konakart.db.KKCriteria,%20java.lang.String,%20int,%20org.apache.torque.Column)">addStringRuleConstraint</a>, <a href="../../../com/konakart/bl/BaseMgr.html#addStringRuleConstraint(com.konakart.db.KKCriteria,%20java.lang.String,%20int,%20java.lang.String)">addStringRuleConstraint</a>, <a href="../../../com/konakart/bl/BaseMgr.html#checkRequired(java.lang.Object,%20java.lang.String,%20java.lang.String)">checkRequired</a>, <a href="../../../com/konakart/bl/BaseMgr.html#escapeHTML(java.lang.String)">escapeHTML</a>, <a href="../../../com/konakart/bl/BaseMgr.html#executeQuery(java.lang.String)">executeQuery</a>, <a href="../../../com/konakart/bl/BaseMgr.html#executeQuery(java.lang.String,%20int,%20int,%20java.lang.String,%20boolean)">executeQuery</a>, <a href="../../../com/konakart/bl/BaseMgr.html#executeQuery(java.lang.String,%20int,%20int,%20java.lang.String,%20boolean,%20boolean,%20java.lang.String)">executeQuery</a>, <a href="../../../com/konakart/bl/BaseMgr.html#executeQuery(java.lang.String,%20int,%20int,%20java.lang.String,%20boolean,%20boolean,%20java.lang.String,%20java.util.List)">executeQuery</a>, <a href="../../../com/konakart/bl/BaseMgr.html#executeQuery(java.lang.String,%20java.util.List)">executeQuery</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getAdminEngMgr()">getAdminEngMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getBasketMgr()">getBasketMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getBillingMgr()">getBillingMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getBookableProductMgr()">getBookableProductMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getCacheMgr()">getCacheMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getCatMgr()">getCatMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getConfigMgr()">getConfigMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getCookieMgr()">getCookieMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getCurrMgr()">getCurrMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getCustMgr()">getCustMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getCustomerIdFromSession(java.lang.String)">getCustomerIdFromSession</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getCustomerStatsMgr()">getCustomerStatsMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getCustomerTagMgr()">getCustomerTagMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getEmailMgr()">getEmailMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getEng()">getEng</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getEventMgr()">getEventMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getExportMgr()">getExportMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getHTMLEscaper()">getHTMLEscaper</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getKonaKartConfig(java.lang.String,%20boolean)">getKonaKartConfig</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getKonaKartConfig(java.lang.String,%20int)">getKonaKartConfig</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getLangMgr()">getLangMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getManuMgr()">getManuMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getMiscItemMgr()">getMiscItemMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getMiscPriceMgr()">getMiscPriceMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getMode()">getMode</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getModeString()">getModeString</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getMqMgr()">getMqMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getMultiStoreMgr()">getMultiStoreMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getNewCriteria()">getNewCriteria</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getNewCriteria(boolean)">getNewCriteria</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getOrderIntegrationMgr()">getOrderIntegrationMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getOrderMgr()">getOrderMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getOrderTotalMgr()">getOrderTotalMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getPaymentMgr()">getPaymentMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getProdMgr()">getProdMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getProductsToCategoresCriteria()">getProductsToCategoresCriteria</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getPromMgr()">getPromMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getPunchOutMgr()">getPunchOutMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getRewardPointMgr()">getRewardPointMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getSecMgr()">getSecMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getShippingMgr()">getShippingMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getSolrMgr()">getSolrMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getStoreId()">getStoreId</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getStoreMgr()">getStoreMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getStoreTime()">getStoreTime</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getTaxMgr()">getTaxMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getTemplate(org.apache.velocity.app.VelocityEngine,%20java.lang.String,%20java.lang.String)">getTemplate</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getTemplateRoot(java.lang.String)">getTemplateRoot</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getVelocityContextMgr()">getVelocityContextMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#getWishListMgr()">getWishListMgr</a>, <a href="../../../com/konakart/bl/BaseMgr.html#init(com.konakart.appif.KKEngIf,%20org.apache.commons.logging.Log)">init</a>, <a href="../../../com/konakart/bl/BaseMgr.html#insertKKEvent(int,%20int,%20int)">insertKKEvent</a>, <a href="../../../com/konakart/bl/BaseMgr.html#insertKKEvent(int,%20int,%20java.lang.String)">insertKKEvent</a>, <a href="../../../com/konakart/bl/BaseMgr.html#isClassPresent(java.lang.String)">isClassPresent</a>, <a href="../../../com/konakart/bl/BaseMgr.html#isDeadlockException(java.sql.SQLException)">isDeadlockException</a>, <a href="../../../com/konakart/bl/BaseMgr.html#isEnterprise()">isEnterprise</a>, <a href="../../../com/konakart/bl/BaseMgr.html#isMultiStoreShareCategories()">isMultiStoreShareCategories</a>, <a href="../../../com/konakart/bl/BaseMgr.html#isMultiStoreShareCustomers()">isMultiStoreShareCustomers</a>, <a href="../../../com/konakart/bl/BaseMgr.html#isMultiStoreShareCustomersOrProducts()">isMultiStoreShareCustomersOrProducts</a>, <a href="../../../com/konakart/bl/BaseMgr.html#isMultiStoreSharedDb()">isMultiStoreSharedDb</a>, <a href="../../../com/konakart/bl/BaseMgr.html#isMultiStoreShareProducts()">isMultiStoreShareProducts</a>, <a href="../../../com/konakart/bl/BaseMgr.html#isMultiVendor()">isMultiVendor</a>, <a href="../../../com/konakart/bl/BaseMgr.html#isUnix()">isUnix</a>, <a href="../../../com/konakart/bl/BaseMgr.html#manageThrowable(java.lang.Throwable)">manageThrowable</a>, <a href="../../../com/konakart/bl/BaseMgr.html#releaseLock(java.lang.String)">releaseLock</a>, <a href="../../../com/konakart/bl/BaseMgr.html#updateStaticVariablesNow(long)">updateStaticVariablesNow</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="log">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>log</h4>
<pre>protected static&nbsp;org.apache.commons.logging.Log log</pre>
<div class="block">the log</div>
</li>
</ul>
<a name="mutex">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>mutex</h4>
<pre>protected static&nbsp;java.lang.String mutex</pre>
<div class="block">mutex</div>
</li>
</ul>
<a name="staticDataHM">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>staticDataHM</h4>
<pre>protected static&nbsp;java.util.Map&lt;java.lang.String,<a href="../../../com/konakart/bl/PromotionMgr.StaticData.html" title="class in com.konakart.bl">PromotionMgr.StaticData</a>&gt; staticDataHM</pre>
<div class="block">Hash Map that contains the static data</div>
</li>
</ul>
<a name="ALL">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>ALL</h4>
<pre>public static final&nbsp;int ALL</pre>
<div class="block">Constant for Promotion Rule</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../constant-values.html#com.konakart.bl.PromotionMgr.ALL">Constant Field Values</a></dd></dl>
</li>
</ul>
<a name="EXCLUDE">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>EXCLUDE</h4>
<pre>public static final&nbsp;int EXCLUDE</pre>
<div class="block">Constant for Promotion Rule</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../constant-values.html#com.konakart.bl.PromotionMgr.EXCLUDE">Constant Field Values</a></dd></dl>
</li>
</ul>
<a name="INCLUDE">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>INCLUDE</h4>
<pre>public static final&nbsp;int INCLUDE</pre>
<div class="block">Constant for Promotion Rule</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../constant-values.html#com.konakart.bl.PromotionMgr.INCLUDE">Constant Field Values</a></dd></dl>
</li>
</ul>
<a name="PROMOTION_RELATION_TYPE">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>PROMOTION_RELATION_TYPE</h4>
<pre>protected static final&nbsp;int PROMOTION_RELATION_TYPE</pre>
<div class="block">Constant for Promotion To Product Relation</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../constant-values.html#com.konakart.bl.PromotionMgr.PROMOTION_RELATION_TYPE">Constant Field Values</a></dd></dl>
</li>
</ul>
<a name="GIFT_CERTIFICATE_RELATION_TYPE">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>GIFT_CERTIFICATE_RELATION_TYPE</h4>
<pre>protected static final&nbsp;int GIFT_CERTIFICATE_RELATION_TYPE</pre>
<div class="block">Constant for Promotion To Product Relation</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../constant-values.html#com.konakart.bl.PromotionMgr.GIFT_CERTIFICATE_RELATION_TYPE">Constant Field Values</a></dd></dl>
</li>
</ul>
<a name="COUPON_DOESNT_EXIST">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>COUPON_DOESNT_EXIST</h4>
<pre>public static final&nbsp;int COUPON_DOESNT_EXIST</pre>
<div class="block">Coupon doesn't exist</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../constant-values.html#com.konakart.bl.PromotionMgr.COUPON_DOESNT_EXIST">Constant Field Values</a></dd></dl>
</li>
</ul>
<a name="COUPON_EXISTS_ACTIVE">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>COUPON_EXISTS_ACTIVE</h4>
<pre>public static final&nbsp;int COUPON_EXISTS_ACTIVE</pre>
<div class="block">Coupon exists and is active</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../constant-values.html#com.konakart.bl.PromotionMgr.COUPON_EXISTS_ACTIVE">Constant Field Values</a></dd></dl>
</li>
</ul>
<a name="COUPON_EXISTS_INACTIVE">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>COUPON_EXISTS_INACTIVE</h4>
<pre>public static final&nbsp;int COUPON_EXISTS_INACTIVE</pre>
<div class="block">Coupon exists but is no longer active</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../constant-values.html#com.konakart.bl.PromotionMgr.COUPON_EXISTS_INACTIVE">Constant Field Values</a></dd></dl>
</li>
</ul>
<a name="promotionUsageCountMaxRetries">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>promotionUsageCountMaxRetries</h4>
<pre>protected static&nbsp;int promotionUsageCountMaxRetries</pre>
<div class="block">Number of times to retry the promotion usage count update SQL</div>
</li>
</ul>
<a name="promotionUseMutex">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>promotionUseMutex</h4>
<pre>protected static&nbsp;java.lang.String promotionUseMutex</pre>
<div class="block">Mutex for updating promotion usage count</div>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="PromotionMgr(com.konakart.appif.KKEngIf)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>PromotionMgr</h4>
<pre>public&nbsp;PromotionMgr(<a href="../../../com/konakart/appif/KKEngIf.html" title="interface in com.konakart.appif">KKEngIf</a>&nbsp;eng)
             throws java.lang.Exception</pre>
<div class="block">Constructor</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>eng</code> - </dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="getPromotions(java.lang.String, com.konakart.app.Order)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getPromotions</h4>
<pre>public&nbsp;<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>[]&nbsp;getPromotions(java.lang.String&nbsp;orderTotalCode,
                        <a href="../../../com/konakart/app/Order.html" title="class in com.konakart.app">Order</a>&nbsp;order)
                          throws java.lang.Exception</pre>
<div class="block">We return all active promotions for the orderTotalCode passed in as a parameter. The
 promotion may only apply for a subset of the products within the order so we return this
 information as an attribute of the Promotion object.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/konakart/blif/PromotionMgrIf.html#getPromotions(java.lang.String,%20com.konakart.app.Order)">getPromotions</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/konakart/blif/PromotionMgrIf.html" title="interface in com.konakart.blif">PromotionMgrIf</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>orderTotalCode</code> - </dd><dd><code>order</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>An array of promotion objects</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="getAllPromotions()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getAllPromotions</h4>
<pre>public&nbsp;<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>[]&nbsp;getAllPromotions()
                             throws java.lang.Exception</pre>
<div class="block">Returns an array of all active promotions</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/konakart/blif/PromotionMgrIf.html#getAllPromotions()">getAllPromotions</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/konakart/blif/PromotionMgrIf.html" title="interface in com.konakart.blif">PromotionMgrIf</a></code></dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns an array of all active promotions</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="checkPromotion(com.konakart.app.Promotion)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkPromotion</h4>
<pre>protected&nbsp;boolean&nbsp;checkPromotion(<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>&nbsp;prm)</pre>
<div class="block">Checks the validity of the promotion object.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>prm</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns true if valid. Otherwise false.</dd></dl>
</li>
</ul>
<a name="checkCustomer(com.konakart.app.Promotion, int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkCustomer</h4>
<pre>protected&nbsp;int&nbsp;checkCustomer(<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>&nbsp;prm,
                int&nbsp;customerId)
                     throws com.workingdogs.village.DataSetException,
                            org.apache.torque.TorqueException</pre>
<div class="block">We check to see whether the customer submitting the order is a customer that can use the
 promotion. He may have to be included explicitly or may have been excluded.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>prm</code> - </dd><dd><code>customerId</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns 0 if the customer can use the promotion. Otherwise a negative number.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>com.workingdogs.village.DataSetException</code></dd>
<dd><code>org.apache.torque.TorqueException</code></dd></dl>
</li>
</ul>
<a name="checkCustomerUse(com.konakart.app.Promotion, int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkCustomerUse</h4>
<pre>protected&nbsp;int&nbsp;checkCustomerUse(<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>&nbsp;prm,
                   int&nbsp;customerId)
                        throws com.workingdogs.village.DataSetException,
                               org.apache.torque.TorqueException</pre>
<div class="block">If the promotion has the maxUse attribute set to a positive value, then we check to see
 whether the customer can still use the promotion or whether he has already used it the
 maximum number of times allowed.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>prm</code> - </dd><dd><code>customerId</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns 0 if the customer can use the promotion. Otherwise a negative number.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>com.workingdogs.village.DataSetException</code></dd>
<dd><code>org.apache.torque.TorqueException</code></dd></dl>
</li>
</ul>
<a name="checkCustomerGroup(com.konakart.app.Promotion, int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkCustomerGroup</h4>
<pre>protected&nbsp;int&nbsp;checkCustomerGroup(<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>&nbsp;prm,
                     int&nbsp;customerId)
                          throws java.lang.Exception</pre>
<div class="block">We check to see whether the group of the customer submitting the order is a group that can
 use the promotion.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>prm</code> - </dd><dd><code>customerId</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns 0 if the customer can use the promotion. Otherwise a negative number.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="checkManufacturer(com.konakart.app.Promotion, com.konakart.appif.ProductIf, java.util.HashMap)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkManufacturer</h4>
<pre>protected&nbsp;int&nbsp;checkManufacturer(<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>&nbsp;prm,
                    <a href="../../../com/konakart/appif/ProductIf.html" title="interface in com.konakart.appif">ProductIf</a>&nbsp;prod,
                    java.util.HashMap&lt;java.lang.String,java.lang.String&gt;&nbsp;promotionManuMap)
                         throws com.workingdogs.village.DataSetException,
                                org.apache.torque.TorqueException</pre>
<div class="block">We check to see whether the product manufacturer is a manufacturer that can use the
 promotion.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>prm</code> - </dd><dd><code>prod</code> - </dd><dd><code>promotionManuMap</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns 0 if the manufacturer can use the promotion. Otherwise a negative number.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>com.workingdogs.village.DataSetException</code></dd>
<dd><code>org.apache.torque.TorqueException</code></dd></dl>
</li>
</ul>
<a name="getPromotionProductMap(com.konakart.appif.PromotionIf[], com.konakart.app.Order, com.konakart.appif.ProductIf[])">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getPromotionProductMap</h4>
<pre>protected&nbsp;java.util.HashMap&lt;java.lang.String,<a href="../../../com/konakart/app/PromotionProduct.html" title="class in com.konakart.app">PromotionProduct</a>&gt;&nbsp;getPromotionProductMap(<a href="../../../com/konakart/appif/PromotionIf.html" title="interface in com.konakart.appif">PromotionIf</a>[]&nbsp;activePromotions,
                                                                          <a href="../../../com/konakart/app/Order.html" title="class in com.konakart.app">Order</a>&nbsp;order,
                                                                          <a href="../../../com/konakart/appif/ProductIf.html" title="interface in com.konakart.appif">ProductIf</a>[]&nbsp;products)
                                                                               throws com.workingdogs.village.DataSetException,
                                                                                      org.apache.torque.TorqueException</pre>
<div class="block">Create a hash map of all of the products associated with the active promotions with a single
 database query. An array of products used in the query is determined from the order parameter
 if not null. Otherwise from the products parameter.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>activePromotions</code> - </dd><dd><code>order</code> - </dd><dd><code>products</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns a promotion product map</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>com.workingdogs.village.DataSetException</code></dd>
<dd><code>org.apache.torque.TorqueException</code></dd></dl>
</li>
</ul>
<a name="getPromotionProductMapKey(int, int, int, int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getPromotionProductMapKey</h4>
<pre>protected&nbsp;java.lang.String&nbsp;getPromotionProductMapKey(int&nbsp;promotionId,
                                         int&nbsp;prodId,
                                         int&nbsp;prodOptionId,
                                         int&nbsp;prodOptionValueId)</pre>
<div class="block">Create a unique key for the Promotion Product Map</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>promotionId</code> - </dd><dd><code>prodId</code> - </dd><dd><code>prodOptionId</code> - </dd><dd><code>prodOptionValueId</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns the key</dd></dl>
</li>
</ul>
<a name="getPromotionManufacturerMap(com.konakart.appif.PromotionIf[])">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getPromotionManufacturerMap</h4>
<pre>protected&nbsp;java.util.HashMap&lt;java.lang.String,java.lang.String&gt;&nbsp;getPromotionManufacturerMap(<a href="../../../com/konakart/appif/PromotionIf.html" title="interface in com.konakart.appif">PromotionIf</a>[]&nbsp;activePromotions)
                                                                                    throws com.workingdogs.village.DataSetException,
                                                                                           org.apache.torque.TorqueException</pre>
<div class="block">Create a hash map of all of the manufacturers associated with the active promotions with a
 single database query</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>activePromotions</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns a promotion manufacturer map</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>com.workingdogs.village.DataSetException</code></dd>
<dd><code>org.apache.torque.TorqueException</code></dd></dl>
</li>
</ul>
<a name="getPromotionManufacturerMapKey(int, int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getPromotionManufacturerMapKey</h4>
<pre>protected&nbsp;java.lang.String&nbsp;getPromotionManufacturerMapKey(int&nbsp;promotionId,
                                              int&nbsp;manuId)</pre>
<div class="block">Create a unique key for the Promotion Manufacturer Map</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>promotionId</code> - </dd><dd><code>manuId</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns the key</dd></dl>
</li>
</ul>
<a name="getPromotionCategoryMap(com.konakart.appif.PromotionIf[])">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getPromotionCategoryMap</h4>
<pre>protected&nbsp;java.util.HashMap&lt;java.lang.String,java.lang.String&gt;&nbsp;getPromotionCategoryMap(<a href="../../../com/konakart/appif/PromotionIf.html" title="interface in com.konakart.appif">PromotionIf</a>[]&nbsp;activePromotions)
                                                                                throws java.lang.Exception</pre>
<div class="block">Create a hash map of all of the categories associated with the active promotions with a
 single database query</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>activePromotions</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns a promotion category map</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="getPromotionCategoryMapKey(int, int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getPromotionCategoryMapKey</h4>
<pre>protected&nbsp;java.lang.String&nbsp;getPromotionCategoryMapKey(int&nbsp;promotionId,
                                          int&nbsp;catId)</pre>
<div class="block">Create a unique key for the Promotion Category Map</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>promotionId</code> - </dd><dd><code>catId</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns the key</dd></dl>
</li>
</ul>
<a name="getPromotionExpressionMap(com.konakart.appif.PromotionIf[])">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getPromotionExpressionMap</h4>
<pre>protected&nbsp;java.util.HashMap&lt;java.lang.Integer,java.util.ArrayList&lt;java.lang.Integer&gt;&gt;&nbsp;getPromotionExpressionMap(<a href="../../../com/konakart/appif/PromotionIf.html" title="interface in com.konakart.appif">PromotionIf</a>[]&nbsp;activePromotions)
                                                                                                         throws com.workingdogs.village.DataSetException,
                                                                                                                org.apache.torque.TorqueException</pre>
<div class="block">Create a hash map of all of the expressions associated with the active promotions with a
 single database query</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>activePromotions</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns a hash map containing a list of expression ids for each promotion id</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>com.workingdogs.village.DataSetException</code></dd>
<dd><code>org.apache.torque.TorqueException</code></dd></dl>
</li>
</ul>
<a name="checkProduct(com.konakart.app.Promotion, com.konakart.appif.OrderProductIf, java.util.HashMap)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkProduct</h4>
<pre>protected&nbsp;int&nbsp;checkProduct(<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>&nbsp;prm,
               <a href="../../../com/konakart/appif/OrderProductIf.html" title="interface in com.konakart.appif">OrderProductIf</a>&nbsp;orderProd,
               java.util.HashMap&lt;java.lang.String,<a href="../../../com/konakart/app/PromotionProduct.html" title="class in com.konakart.app">PromotionProduct</a>&gt;&nbsp;promotionProdMap)
                    throws com.workingdogs.village.DataSetException,
                           org.apache.torque.TorqueException</pre>
<div class="block">We check to see whether the product is a product that can use the promotion. The order
 product may contain an array of options so we have to consider each option separately.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>prm</code> - </dd><dd><code>orderProd</code> - </dd><dd><code>promotionProdMap</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns 0 if the orderProd can use the promotion. Otherwise a negative number.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>com.workingdogs.village.DataSetException</code></dd>
<dd><code>org.apache.torque.TorqueException</code></dd></dl>
</li>
</ul>
<a name="checkCategory(com.konakart.app.Promotion, com.konakart.appif.ProductIf, java.util.HashMap, java.util.HashMap)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkCategory</h4>
<pre>protected&nbsp;int&nbsp;checkCategory(<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>&nbsp;prm,
                <a href="../../../com/konakart/appif/ProductIf.html" title="interface in com.konakart.appif">ProductIf</a>&nbsp;prod,
                java.util.HashMap&lt;java.lang.String,java.lang.String&gt;&nbsp;promotionCatMap,
                java.util.HashMap&lt;java.lang.Integer,java.util.ArrayList&lt;java.lang.Integer&gt;&gt;&nbsp;productCatIdMap)
                     throws java.lang.Exception</pre>
<div class="block">We check to see whether the product category is a category that can use the promotion.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>prm</code> - </dd><dd><code>prod</code> - </dd><dd><code>promotionCatMap</code> - </dd><dd><code>productCatIdMap</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns 0 if the category can use the promotion. Otherwise a negative number.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="checkCoupon(com.konakart.app.Promotion, com.konakart.app.Order)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkCoupon</h4>
<pre>protected&nbsp;int&nbsp;checkCoupon(<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>&nbsp;prm,
              <a href="../../../com/konakart/app/Order.html" title="class in com.konakart.app">Order</a>&nbsp;order)
                   throws com.workingdogs.village.DataSetException,
                          org.apache.torque.TorqueException</pre>
<div class="block">If the promotion requires a coupon, we try and find one or more active coupons for the
 promotion that have a coupon code equal to the one in the order. When we find a valid coupon,
 we attach it to the promotion.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>prm</code> - </dd><dd><code>order</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns 0 if the order coupon code matches a valid active coupon for the promotion.
         Otherwise a negative number.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>com.workingdogs.village.DataSetException</code></dd>
<dd><code>org.apache.torque.TorqueException</code></dd></dl>
</li>
</ul>
<a name="checkCoupon(com.konakart.app.Promotion, java.lang.String[])">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkCoupon</h4>
<pre>protected&nbsp;int&nbsp;checkCoupon(<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>&nbsp;prm,
              java.lang.String[]&nbsp;coupons)
                   throws com.workingdogs.village.DataSetException,
                          org.apache.torque.TorqueException</pre>
<div class="block">If the promotion requires a coupon, we try and find one or more active coupons for the
 promotion that have a coupon code equal to one of the ones the array. When we find a valid
 coupon, we attach it to the promotion.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>prm</code> - </dd><dd><code>coupons</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns 0 if the coupon code matches a valid active coupon for the promotion.
         Otherwise a negative number.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>com.workingdogs.village.DataSetException</code></dd>
<dd><code>org.apache.torque.TorqueException</code></dd></dl>
</li>
</ul>
<a name="checkExpression(com.konakart.app.Promotion, int, java.util.HashMap)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkExpression</h4>
<pre>protected&nbsp;int&nbsp;checkExpression(<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>&nbsp;prm,
                  int&nbsp;customerId,
                  java.util.HashMap&lt;java.lang.Integer,java.util.ArrayList&lt;java.lang.Integer&gt;&gt;&nbsp;expressionIdMap)
                       throws java.lang.Exception</pre>
<div class="block">We check to see whether the expression evaluates to TRUE</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>prm</code> - </dd><dd><code>customerId</code> - </dd><dd><code>expressionIdMap</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns 0 if the expression evaluates to TRUE or doesn't exist. Otherwise a negative
         number.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="getPromotionsPerOrderTotalCode(java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getPromotionsPerOrderTotalCode</h4>
<pre>protected&nbsp;<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>[]&nbsp;getPromotionsPerOrderTotalCode(java.lang.String&nbsp;orderTotalCode)
                                              throws java.lang.Exception</pre>
<div class="block">The active promotions related to the list of orderTotalCodes passed in as a parameter, are
 fetched from the database and returned.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>orderTotalCode</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns an array of promotion objects</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="getPromotionsPerOrderTotalCode(java.util.ArrayList)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getPromotionsPerOrderTotalCode</h4>
<pre>protected&nbsp;<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>[]&nbsp;getPromotionsPerOrderTotalCode(java.util.ArrayList&lt;java.lang.String&gt;&nbsp;orderTotalCodeList)
                                              throws java.lang.Exception</pre>
<div class="block">The active promotions related to the list of orderTotalCodes passed in as a parameter, are
 fetched from the database and returned.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>orderTotalCodeList</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns an array of promotion objects</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="updatePromotionUsage(com.konakart.app.Order)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>updatePromotionUsage</h4>
<pre>public&nbsp;void&nbsp;updatePromotionUsage(<a href="../../../com/konakart/app/Order.html" title="class in com.konakart.app">Order</a>&nbsp;order)
                          throws java.lang.Exception</pre>
<div class="block">If the order has any associated coupons we iterate through the coupons and increment the
 timesUsed attribute. If the order has any associated promotions that were linked to the
 customer directly through the promotion_to_customer table, then we retrieve these records and
 increment the timesUsed attribute.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/konakart/blif/PromotionMgrIf.html#updatePromotionUsage(com.konakart.app.Order)">updatePromotionUsage</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/konakart/blif/PromotionMgrIf.html" title="interface in com.konakart.blif">PromotionMgrIf</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>order</code> - </dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="setPromotionCriteriaWithStandardAttributes(com.konakart.db.KKCriteria)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setPromotionCriteriaWithStandardAttributes</h4>
<pre>protected&nbsp;void&nbsp;setPromotionCriteriaWithStandardAttributes(<a href="../../../com/konakart/db/KKCriteria.html" title="class in com.konakart.db">KKCriteria</a>&nbsp;c)</pre>
<div class="block">Set the criteria object with all of the attributes for a promotion</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>c</code> - </dd></dl>
</li>
</ul>
<a name="setCouponCriteriaWithStandardAttributes(com.konakart.db.KKCriteria)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setCouponCriteriaWithStandardAttributes</h4>
<pre>protected&nbsp;void&nbsp;setCouponCriteriaWithStandardAttributes(<a href="../../../com/konakart/db/KKCriteria.html" title="class in com.konakart.db">KKCriteria</a>&nbsp;c)</pre>
<div class="block">Set the criteria object with all of the attributes for a coupon</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>c</code> - </dd></dl>
</li>
</ul>
<a name="getPromotionIdForGiftCertificate(com.konakart.appif.OrderProductIf)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getPromotionIdForGiftCertificate</h4>
<pre>public&nbsp;int&nbsp;getPromotionIdForGiftCertificate(<a href="../../../com/konakart/appif/OrderProductIf.html" title="interface in com.konakart.appif">OrderProductIf</a>&nbsp;op)
                                     throws com.konakart.app.KKException,
                                            org.apache.torque.TorqueException,
                                            com.workingdogs.village.DataSetException</pre>
<div class="block">Get the promotion id for an order product object containing a gift certificate. A negative id
 is returned if a promotion doesn't exist.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/konakart/blif/PromotionMgrIf.html#getPromotionIdForGiftCertificate(com.konakart.appif.OrderProductIf)">getPromotionIdForGiftCertificate</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/konakart/blif/PromotionMgrIf.html" title="interface in com.konakart.blif">PromotionMgrIf</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>op</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns the id of the promotion or -1 if a promotion doesn't exist.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>com.konakart.app.KKException</code></dd>
<dd><code>org.apache.torque.TorqueException</code></dd>
<dd><code>com.workingdogs.village.DataSetException</code></dd></dl>
</li>
</ul>
<a name="getPromotionIdForGiftCertificate(int, int, int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getPromotionIdForGiftCertificate</h4>
<pre>protected&nbsp;int&nbsp;getPromotionIdForGiftCertificate(int&nbsp;productId,
                                   int&nbsp;productOptionId,
                                   int&nbsp;productOptionValueId)
                                        throws org.apache.torque.TorqueException,
                                               com.workingdogs.village.DataSetException</pre>
<div class="block">Protected method for common code to get the promotion id of a promotion connected to a gift
 certificate. There should only be one promotion.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>productId</code> - </dd><dd><code>productOptionId</code> - </dd><dd><code>productOptionValueId</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns the id of the promotion</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>org.apache.torque.TorqueException</code></dd>
<dd><code>com.workingdogs.village.DataSetException</code></dd></dl>
</li>
</ul>
<a name="insertCoupon(com.konakart.appif.CouponIf, int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>insertCoupon</h4>
<pre>public&nbsp;int&nbsp;insertCoupon(<a href="../../../com/konakart/appif/CouponIf.html" title="interface in com.konakart.appif">CouponIf</a>&nbsp;coupon,
               int&nbsp;promotionId)
                 throws java.lang.Exception</pre>
<div class="block">Insert a coupon and associate it with the promotion referenced by promotionId. If the
 promotionId is a negative number then no association is done.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/konakart/blif/PromotionMgrIf.html#insertCoupon(com.konakart.appif.CouponIf,%20int)">insertCoupon</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/konakart/blif/PromotionMgrIf.html" title="interface in com.konakart.blif">PromotionMgrIf</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>coupon</code> - </dd><dd><code>promotionId</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns the couponId</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="validateCoupon(com.konakart.appif.CouponIf)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>validateCoupon</h4>
<pre>protected&nbsp;void&nbsp;validateCoupon(<a href="../../../com/konakart/appif/CouponIf.html" title="interface in com.konakart.appif">CouponIf</a>&nbsp;coupon)
                       throws com.konakart.app.KKException</pre>
<div class="block">Used to validate a coupon before inserting</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>coupon</code> - </dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>com.konakart.app.KKException</code></dd></dl>
</li>
</ul>
<a name="checkCoupon(java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkCoupon</h4>
<pre>public&nbsp;int&nbsp;checkCoupon(java.lang.String&nbsp;couponCode)
                throws com.workingdogs.village.DataSetException,
                       org.apache.torque.TorqueException</pre>
<div class="block">This method is used to verify whether a coupon code actually exists and if it does, whether
 the coupon is still active. Valid return values for this method are:
 <ul>
 <li>com.konakart.bl.PromotionMgr.COUPON_DOESNT_EXIST - The coupon code does not exist.</li>
 <li>com.konakart.bl.PromotionMgr.COUPON_EXISTS_ACTIVE - The coupon code does exist and the
 coupon is still active.</li>
 <li>com.konakart.bl.PromotionMgr.COUPON_EXISTS_INACTIVE - The coupon code does exist but the
 coupon is no longer active since the number of times it has been used has reached the maximum
 number of times allowed.</li>
 </ul>
 Even if the coupon exists and is active, it won't actually do anything if it isn't connected
 to a valid promotion and any rules associated with the promotion are also satisfied. However,
 this method may still be used to at least warn a customer that he may have mistyped the
 coupon code or that it is no longer valid.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/konakart/blif/PromotionMgrIf.html#checkCoupon(java.lang.String)">checkCoupon</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/konakart/blif/PromotionMgrIf.html" title="interface in com.konakart.blif">PromotionMgrIf</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>couponCode</code> - The coupon code</dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns an integer</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>com.workingdogs.village.DataSetException</code></dd>
<dd><code>org.apache.torque.TorqueException</code></dd></dl>
</li>
</ul>
<a name="getPromotionsPerProducts(java.lang.String, int, com.konakart.appif.ProductIf[], com.konakart.appif.PromotionIf[], java.lang.String[], com.konakart.appif.PromotionOptionsIf)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getPromotionsPerProducts</h4>
<pre>public&nbsp;<a href="../../../com/konakart/appif/ProductIf.html" title="interface in com.konakart.appif">ProductIf</a>[]&nbsp;getPromotionsPerProducts(java.lang.String&nbsp;sessionId,
                                   int&nbsp;customerId,
                                   <a href="../../../com/konakart/appif/ProductIf.html" title="interface in com.konakart.appif">ProductIf</a>[]&nbsp;products,
                                   <a href="../../../com/konakart/appif/PromotionIf.html" title="interface in com.konakart.appif">PromotionIf</a>[]&nbsp;promotions,
                                   java.lang.String[]&nbsp;couponCodes,
                                   <a href="../../../com/konakart/appif/PromotionOptionsIf.html" title="interface in com.konakart.appif">PromotionOptionsIf</a>&nbsp;options)
                                     throws java.lang.Exception</pre>
<div class="block">This method is used to calculate a discount on individual products so that the discount can
 be displayed without having to add the product to the cart.<br>
 The method receives an array of products and returns an array of products with attached
 PromotionResult objects that contain the results of one or more of the promotions passed in
 as a parameter. The PromotionResult contains the value of the discount, whether it is an
 amount or a percentage discount and also information regarding the promotion it applies to.
 If a product has an array of ProductQuantity objects (one for each SKU) each one of these may
 have an array of PromotionResult objects since a promotion may only apply to one product
 configuration and not to another (i.e. blue shirt and not red shirt).<br>
 The PromotionOptions object can be configured so that the values of the promotions for a
 product are subtracted from the product price. The options allow you to set rules that
 determine whether in this case the promotions need to be cumulative or whether the largest or
 smallest should be chosen. The calculation is only made for products with a single array of
 PromotionResult objects. It is not calculated for products that have an array of
 PromotionResult objects for each ProductQuantity.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/konakart/blif/PromotionMgrIf.html#getPromotionsPerProducts(java.lang.String,%20int,%20com.konakart.appif.ProductIf[],%20com.konakart.appif.PromotionIf[],%20java.lang.String[],%20com.konakart.appif.PromotionOptionsIf)">getPromotionsPerProducts</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/konakart/blif/PromotionMgrIf.html" title="interface in com.konakart.blif">PromotionMgrIf</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>sessionId</code> - Only used if the customer is logged in. Otherwise set to null.</dd><dd><code>customerId</code> - If the sessionId is set to null then the customerId should contain the id of the
            temporary user which is a negative number. The temporary user id can be used for
            evaluating expression rules.</dd><dd><code>products</code> - An array of products to be processed</dd><dd><code>promotions</code> - The promotions which will be applied to the products if all rules are matched.</dd><dd><code>couponCodes</code> - Coupon codes to use. If none of the promotions require coupons, it should be set
            to null</dd><dd><code>options</code> - An object containing information to configure the calculation for applying one or
            more promotion results to the product price.</dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns the same array of products passed in as a parameter with attached
         PromotionResult objects if applicable</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="processPrice(com.konakart.appif.ProductIf, com.konakart.appif.PromotionOptionsIf)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>processPrice</h4>
<pre>protected&nbsp;void&nbsp;processPrice(<a href="../../../com/konakart/appif/ProductIf.html" title="interface in com.konakart.appif">ProductIf</a>&nbsp;prod,
                <a href="../../../com/konakart/appif/PromotionOptionsIf.html" title="interface in com.konakart.appif">PromotionOptionsIf</a>&nbsp;options)</pre>
<div class="block">We apply the discount to a product, taking into consideration the rules to decide which
 promotion discount to select</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>prod</code> - </dd><dd><code>options</code> - </dd></dl>
</li>
</ul>
<a name="applyDiscount(com.konakart.appif.ProductIf, com.konakart.appif.PromotionResultIf, com.konakart.appif.PromotionOptionsIf)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>applyDiscount</h4>
<pre>protected&nbsp;void&nbsp;applyDiscount(<a href="../../../com/konakart/appif/ProductIf.html" title="interface in com.konakart.appif">ProductIf</a>&nbsp;prod,
                 <a href="../../../com/konakart/appif/PromotionResultIf.html" title="interface in com.konakart.appif">PromotionResultIf</a>&nbsp;promResult,
                 <a href="../../../com/konakart/appif/PromotionOptionsIf.html" title="interface in com.konakart.appif">PromotionOptionsIf</a>&nbsp;options)</pre>
<div class="block">Apply the promotion discount to a product</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>prod</code> - </dd><dd><code>promResult</code> - </dd><dd><code>options</code> - </dd></dl>
</li>
</ul>
<a name="getPromotionResultArray(com.konakart.appif.PromotionResultIf[], com.konakart.app.PromotionResult)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getPromotionResultArray</h4>
<pre>protected&nbsp;<a href="../../../com/konakart/appif/PromotionResultIf.html" title="interface in com.konakart.appif">PromotionResultIf</a>[]&nbsp;getPromotionResultArray(<a href="../../../com/konakart/appif/PromotionResultIf.html" title="interface in com.konakart.appif">PromotionResultIf</a>[]&nbsp;currentArray,
                                          <a href="../../../com/konakart/app/PromotionResult.html" title="class in com.konakart.app">PromotionResult</a>&nbsp;newResult)</pre>
<div class="block">Utility method to add a PromotionResult object on to the end of an array</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>currentArray</code> - </dd><dd><code>newResult</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns an array of PromotionResult objects</dd></dl>
</li>
</ul>
<a name="getOrderProductsFromProduct(com.konakart.appif.ProductIf)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getOrderProductsFromProduct</h4>
<pre>protected&nbsp;<a href="../../../com/konakart/app/OrderProduct.html" title="class in com.konakart.app">OrderProduct</a>[]&nbsp;getOrderProductsFromProduct(<a href="../../../com/konakart/appif/ProductIf.html" title="interface in com.konakart.appif">ProductIf</a>&nbsp;prod)
                                              throws java.lang.Exception</pre>
<div class="block">Creates OrderProducts from a product so that we can reuse the checkProduct() method.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>prod</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns an array of OrderProduct objects</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="getCustomerId(java.lang.String, int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getCustomerId</h4>
<pre>protected&nbsp;int&nbsp;getCustomerId(java.lang.String&nbsp;sessionId,
                int&nbsp;customerId)
                     throws java.lang.Exception</pre>
<div class="block">If the sessionId is null, we check the customerId to ensure that it is negative. If it is
 negative, this means that it is a non registered customer or a customer that hasn't logged in
 yet and so there is no customer mapped to the session id. Otherwise we ensure that the
 sessionId is valid and we don't use the customerId because we get the id from the session.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>sessionId</code> - </dd><dd><code>customerId</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns the customerId that should be used by the caller</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="refreshConfigs()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>refreshConfigs</h4>
<pre>public&nbsp;void&nbsp;refreshConfigs()
                    throws java.lang.Exception</pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../com/konakart/blif/PromotionMgrIf.html#refreshConfigs()">PromotionMgrIf</a></code></strong></div>
<div class="block">Refresh the configuration of the Promotion manager</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/konakart/blif/PromotionMgrIf.html#refreshConfigs()">refreshConfigs</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/konakart/blif/PromotionMgrIf.html" title="interface in com.konakart.blif">PromotionMgrIf</a></code></dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="getCouponsPerCode(java.lang.String, com.konakart.appif.CouponOptionsIf)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getCouponsPerCode</h4>
<pre>public&nbsp;<a href="../../../com/konakart/app/Coupon.html" title="class in com.konakart.app">Coupon</a>[]&nbsp;getCouponsPerCode(java.lang.String&nbsp;couponCode,
                         <a href="../../../com/konakart/appif/CouponOptionsIf.html" title="interface in com.konakart.appif">CouponOptionsIf</a>&nbsp;options)
                           throws java.lang.Exception</pre>
<div class="block">Returns an array of coupons for the coupon code passed in as a parameter.
 <p>
 The options object allows you to specify that only active coupons should be returned.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/konakart/blif/PromotionMgrIf.html#getCouponsPerCode(java.lang.String,%20com.konakart.appif.CouponOptionsIf)">getCouponsPerCode</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/konakart/blif/PromotionMgrIf.html" title="interface in com.konakart.blif">PromotionMgrIf</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>couponCode</code> - </dd><dd><code>options</code> - Allows you to specify that only active coupons should be returned</dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns an array of coupons. An empty array is returned if no coupons are available.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="getCouponPerId(int, com.konakart.appif.CouponOptionsIf)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getCouponPerId</h4>
<pre>public&nbsp;<a href="../../../com/konakart/app/Coupon.html" title="class in com.konakart.app">Coupon</a>&nbsp;getCouponPerId(int&nbsp;couponId,
                    <a href="../../../com/konakart/appif/CouponOptionsIf.html" title="interface in com.konakart.appif">CouponOptionsIf</a>&nbsp;options)
                      throws java.lang.Exception</pre>
<div class="block">Returns a coupon for the coupon id passed in as a parameter.
 <p>
 The options object allows you to specify that only active coupons should be returned.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/konakart/blif/PromotionMgrIf.html#getCouponPerId(int,%20com.konakart.appif.CouponOptionsIf)">getCouponPerId</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/konakart/blif/PromotionMgrIf.html" title="interface in com.konakart.blif">PromotionMgrIf</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>couponId</code> - </dd><dd><code>options</code> - Allows you to specify that only active coupons should be returned</dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns a coupon object or null if a coupon isn't available.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="getPromotionsPerCoupon(java.lang.String, int, com.konakart.appif.PromotionOptionsIf)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getPromotionsPerCoupon</h4>
<pre>public&nbsp;<a href="../../../com/konakart/app/Promotion.html" title="class in com.konakart.app">Promotion</a>[]&nbsp;getPromotionsPerCoupon(java.lang.String&nbsp;couponCode,
                                 int&nbsp;couponId,
                                 <a href="../../../com/konakart/appif/PromotionOptionsIf.html" title="interface in com.konakart.appif">PromotionOptionsIf</a>&nbsp;options)
                                   throws java.lang.Exception</pre>
<div class="block">This method is used to return an array of promotions associated with the coupon(s) identified
 by the input parameters. The method will either use the couponCode or the couponId parameter.
 The couponCode is used if not null, otherwise couponId is used. Note that multiple coupons
 may share the same coupon code.
 <p>
 The PromotionOptions may be used to control whether or not to use expired coupons and whether
 or not to return expired promotions. The default is to not check whether coupons or
 promotions have expired.
 <p>
 If no promotions are found, an empty array is returned.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/konakart/blif/PromotionMgrIf.html#getPromotionsPerCoupon(java.lang.String,%20int,%20com.konakart.appif.PromotionOptionsIf)">getPromotionsPerCoupon</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/konakart/blif/PromotionMgrIf.html" title="interface in com.konakart.blif">PromotionMgrIf</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>couponCode</code> - The code of the coupon</dd><dd><code>couponId</code> - The unique numeric id of the coupon</dd><dd><code>options</code> - A PromotionOptions object to control whether or not to use expired coupons and
            whether or not to return expired promotions</dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns an array of promotions</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="getPromotionUsageCountMaxRetries()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getPromotionUsageCountMaxRetries</h4>
<pre>public&nbsp;int&nbsp;getPromotionUsageCountMaxRetries()</pre>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/konakart/blif/PromotionMgrIf.html#getPromotionUsageCountMaxRetries()">getPromotionUsageCountMaxRetries</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/konakart/blif/PromotionMgrIf.html" title="interface in com.konakart.blif">PromotionMgrIf</a></code></dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns the maximum number of optimistic concurrency retries when setting the
         promotion usage count</dd></dl>
</li>
</ul>
<a name="setPromotionUsageCountMaxRetries(int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setPromotionUsageCountMaxRetries</h4>
<pre>public&nbsp;void&nbsp;setPromotionUsageCountMaxRetries(int&nbsp;promotionUsageCountMaxRetries)</pre>
<div class="block">The maximum number of optimistic concurrency retries when setting the promotion usage count</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/konakart/blif/PromotionMgrIf.html#setPromotionUsageCountMaxRetries(int)">setPromotionUsageCountMaxRetries</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/konakart/blif/PromotionMgrIf.html" title="interface in com.konakart.blif">PromotionMgrIf</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>promotionUsageCountMaxRetries</code> - the promotionUsageCountMaxRetries to set</dd></dl>
</li>
</ul>
<a name="getPromotion(int, java.lang.String, int, com.konakart.appif.FetchPromotionOptionsIf, com.konakart.appif.FetchProductOptionsIf)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>getPromotion</h4>
<pre>public&nbsp;<a href="../../../com/konakart/appif/PromotionIf.html" title="interface in com.konakart.appif">PromotionIf</a>&nbsp;getPromotion(int&nbsp;promotionId,
                       java.lang.String&nbsp;promotionName,
                       int&nbsp;languageId,
                       <a href="../../../com/konakart/appif/FetchPromotionOptionsIf.html" title="interface in com.konakart.appif">FetchPromotionOptionsIf</a>&nbsp;prmOptions,
                       <a href="../../../com/konakart/appif/FetchProductOptionsIf.html" title="interface in com.konakart.appif">FetchProductOptionsIf</a>&nbsp;prodOptions)
                         throws java.lang.Exception</pre>
<div class="block">This API call is used to retrieve a single promotion matching an id or name. Depending on how
 the options are configured, the returned object may have its arrays of included / excluded
 products, categories and manufacturers populated. If a product has options (variants) then we
 return the product populated with all of the options that are included or excluded for the
 promotion.
 <p>
 The purpose of this method is mainly to determine what products, manufacturers or categories
 are included or excluded from the promotion in order to be able to display this information
 on the storefront. However if the <code>FetchPromotionOptions</code> is configured to only
 return the promotion if active, then we check the following:
 <ul>
 <li>That the promotion is active.</li>
 <li>That the current time is within the configured date range of the promotion.</li>
 <li>That the promotion hasn't reached its max usage limit.</li>
 <li>If the <code>couponCodes</code> attribute of the <code>FetchPromotionOptions</code>
 object has been populated and the promotion requires a coupon then we check that at least one
 coupon will activate the promotion.</li>
 <li>That the customer hasn't been excluded from the promotion.</li>
 <li>That the customer hasn't reached his personal max usage limit.</li>
 <li>That the customer group isn't excluded from the promotion.</li>
 <li>That any one expression attached to the promotion evaluates to true.</li>
 </ul></div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/konakart/blif/PromotionMgrIf.html#getPromotion(int,%20java.lang.String,%20int,%20com.konakart.appif.FetchPromotionOptionsIf,%20com.konakart.appif.FetchProductOptionsIf)">getPromotion</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/konakart/blif/PromotionMgrIf.html" title="interface in com.konakart.blif">PromotionMgrIf</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>promotionId</code> - The numeric id of the promotion used to identify it. It should be set to a
            negative number in order to search for the promotion using the promotion name.</dd><dd><code>promotionName</code> - If not set to null, the promotion name is used to search for the promotion instead
            of the numeric id.</dd><dd><code>languageId</code> - The id for the language that will be used when creating the attached products,
            categories and manufacturers. Value of -1 selects the default language.</dd><dd><code>prmOptions</code> - A FetchPromotionOptions object used to configure the API call. It may be set to
            null for default functionality.</dd><dd><code>prodOptions</code> - A FetchProductOptions used to configure the products (if any) attached to the
            promotion. It may be set to null for default functionality.</dd>
<dt><span class="strong">Returns:</span></dt><dd>Returns a fully populated promotion object</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../com/konakart/bl/ProductMgrEE.html" title="class in com.konakart.bl"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../com/konakart/bl/PromotionMgr.StaticData.html" title="class in com.konakart.bl"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?com/konakart/bl/PromotionMgr.html" target="_top">Frames</a></li>
<li><a href="PromotionMgr.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested_class_summary">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &copy; 2011 DS Data Systems UK Ltd.</small></p>
</body>
</html>
